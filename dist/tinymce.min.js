angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(a,b,c,d,e,f,g){return f=f||{},f.baseUrl&&(tinymce.baseURL=f.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(h,i,j,k){function l(a){a?(m(),o&&o.getBody().setAttribute("contenteditable",!1)):(m(),o&&!o.settings.readonly&&o.getDoc()&&o.getBody().setAttribute("contenteditable",!0))}function m(){o||(o=tinymce.get(j.id))}if(d.tinymce){var n,o,p=k[0],q=k[1]||null,r=!1,s={debounce:!0},t=function(b){var c=b.getContent({format:s.format}).trim();c=e.trustAsHtml(c),p.$setViewValue(c),a.$$phase||h.$digest()},u=g.getUniqueId();j.$set("id",u),n={},angular.extend(n,h.$eval(j.uiTinymce));var v=function(a){var b;return function(d){c.cancel(b),b=c(function(){return function(a){(a.isDirty()||r)&&(a.save(),t(a))}(d)},a)}}(400),w={setup:function(b){b.on("init",function(){p.$render(),p.$setPristine(),p.$setUntouched(),q&&q.$setPristine();var a=this.editorManager.activeEditor,b=tinymce.DOM.get(a.id+"_ifr"),c=tinymce.DOM.getAttrib(a.id,"aria-labelledby");if(document.getElementById(c)){var d=document.getElementById(c).innerText;d&&(d+=" Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help",a.dom.setAttrib(b,"title",d))}}),b.on("ExecCommand change NodeChange ObjectResized undo redo cut paste",function(a){return["undo","redo","cut","paste"].indexOf(a.type)!==-1&&(r=!0),s.debounce?void v(b):(b.save(),void t(b))}),b.on("keyDown",function(){r=!0}),b.on("blur",function(){i[0].blur(),p.$setTouched(),a.$$phase||h.$digest()}),b.on("remove",function(){i.remove()}),f.setup&&f.setup(b,{updateView:t}),n.setup&&n.setup(b,{updateView:t})},format:n.format||"html",selector:"#"+j.id};angular.extend(s,f,n,w),c(function(){s.baseURL&&(tinymce.baseURL=s.baseURL);var a=tinymce.init(s);a&&"function"==typeof a.then?a.then(function(){l(h.$eval(j.ngDisabled))}):l(h.$eval(j.ngDisabled))}),p.$formatters.unshift(function(a){return a?e.trustAsHtml(a):""}),p.$parsers.unshift(function(a){return a?e.getTrustedHtml(a):""}),p.$render=function(){m();var a=p.$viewValue?e.getTrustedHtml(p.$viewValue):"";o&&o.getDoc()&&(o.setContent(a),o.fire("change"))},j.$observe("disabled",l);var x=h.$on("$tinymce:refresh",function(a,c){var d=j.id;if(angular.isUndefined(c)||c===d){var e=i.parent(),f=i.clone();f.removeAttr("id"),f.removeAttr("style"),f.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,d),e.append(b(f)(h)),x()}});h.$on("$destroy",function(){m(),o&&(o.remove(),o=null)})}}}}]).service("uiTinymceService",[function(){var a=function(){var a="ui-tinymce",b=0,c=function(){return b++,a+"-"+b};return{getUniqueId:c}};return new a}]);